(ns azjure.cipher.tea-spec
  (:require [azjure.libtest :refer :all]
            [speclj.core :refer :all]))

(def ^{:doc "Base TEA/ECB test ciphertext"}
  ct-64-tea-ecb-base
  [0x9b 0xce 0xcc 0xf1 0xd9 0x55 0xd0 0xcd
   0x93 0xd2 0xcd 0xca 0x50 0x09 0x66 0x99
   0x39 0xf6 0x89 0xac 0xa5 0x0d 0x38 0x80
   0x16 0xf6 0x65 0x58 0x3d 0x73 0x67 0x59
   0x9c 0x7d 0x9c 0xc1 0xac 0xfb 0xa2 0x75])

(def ^{:doc "TEA/ECB/X923 test ciphertext"}
  ct-64-tea-ecb-x923
  (into ct-64-tea-ecb-base [0x81 0x56 0x81 0x96 0xa8 0xdb 0xbd 0xc3]))

(def ^{:doc "TEA/ECB/ISO7816 test ciphertext"}
  ct-64-tea-ecb-iso7816
  (into ct-64-tea-ecb-base [0x91 0x17 0x67 0x13 0x20 0xb9 0x17 0xa4]))

(def ^{:doc "TEA/ECB/PKCS7 test ciphertext"}
  ct-64-tea-ecb-pkcs7
  (into ct-64-tea-ecb-base [0x44 0x95 0x4a 0x2e 0xb8 0x9f 0x5b 0xed]))

(def ^{:doc "TEA/ECB/ZERO test ciphertext"}
  ct-64-tea-ecb-zero
  (into ct-64-tea-ecb-base [0x32 0x22 0xc6 0x8c 0x3c 0xa5 0x18 0x9f]))

(def ^{:doc "Base TEA/CBC test ciphertext"}
  ct-64-tea-cbc-base
  [0x9b 0xce 0xcc 0xf1 0xd9 0x55 0xd0 0xcd
   0x87 0x71 0x54 0xee 0xce 0xec 0x19 0x2d
   0xfb 0x23 0xa7 0x07 0xd5 0x10 0xd2 0x98
   0xa7 0x78 0x6a 0x67 0xbe 0x33 0x6f 0xda
   0x21 0x63 0x34 0xf7 0xe9 0xc8 0x3f 0x8f])

(def ^{:doc "TEA/CBC/X923 test ciphertext"}
  ct-64-tea-cbc-x923
  (into ct-64-tea-cbc-base [0x1d 0xe2 0x31 0xfd 0x88 0xeb 0x3b 0xec]))

(def ^{:doc "TEA/CBC/ISO7816 test ciphertext"}
  ct-64-tea-cbc-iso7816
  (into ct-64-tea-cbc-base [0x5f 0x09 0x7c 0xdc 0xfe 0x81 0xe2 0xce]))

(def ^{:doc "TEA/CBC/PKCS7 test ciphertext"}
  ct-64-tea-cbc-pkcs7
  (into ct-64-tea-cbc-base [0x88 0x67 0xf0 0x1c 0x09 0xe5 0x96 0x72]))

(def ^{:doc "TEA/CBC/ZERO test ciphertext"}
  ct-64-tea-cbc-zero
  (into ct-64-tea-cbc-base [0x27 0xf2 0x67 0x5e 0x7e 0x97 0xc1 0x47]))

(def ^{:doc "Base TEA/PCBC test ciphertext"}
  ct-64-tea-pcbc-base
  [0x9b 0xce 0xcc 0xf1 0xd9 0x55 0xd0 0xcd
   0xec 0x35 0x8d 0xfc 0xc0 0xd0 0xd5 0x2c
   0xd3 0xa8 0xb1 0xf3 0x2a 0xd0 0xfd 0x23
   0x79 0x21 0x64 0x21 0xa2 0x7d 0x92 0xbd
   0xd1 0x1b 0xc1 0xf9 0xbe 0x5d 0x9d 0xcb])

(def ^{:doc "TEA/PCBC/X923 test ciphertext"}
  ct-64-tea-pcbc-x923
  (into ct-64-tea-pcbc-base [0x00 0x46 0xe5 0x60 0x40 0x0b 0xe9 0xca]))

(def ^{:doc "TEA/PCBC/ISO7816 test ciphertext"}
  ct-64-tea-pcbc-iso7816
  (into ct-64-tea-pcbc-base [0x82 0xbe 0xb2 0xf0 0xc6 0xa4 0x32 0x14]))

(def ^{:doc "TEA/PCBC/PKCS7 test ciphertext"}
  ct-64-tea-pcbc-pkcs7
  (into ct-64-tea-pcbc-base [0x15 0x2c 0x0d 0xb2 0x27 0xfc 0x40 0x7c]))

(def ^{:doc "TEA/PCBC/ZERO test ciphertext"}
  ct-64-tea-pcbc-zero
  (into ct-64-tea-pcbc-base [0xce 0x5f 0xc5 0x49 0x54 0xd9 0x4a 0xf4]))

(def ^{:doc "Base TEA/CFB test ciphertext"}
  ct-64-tea-cfb-base
  [0x15 0x82 0x5f 0x2a 0xe5 0xcf 0xc0 0x23
   0xb8 0x98 0x30 0x57 0xa1 0x40 0xe5 0xf0
   0x9b 0x5a 0x32 0x25 0x31 0x17 0xb9 0xbb
   0x83 0x32 0xae 0x08 0xeb 0xb1 0xc0 0xd2
   0x5c 0xea 0xbc 0xae 0xad 0x44 0xeb 0x09])

(def ^{:doc "TEA/CFB/X923 test ciphertext"}
  ct-64-tea-cfb-x923
  (into ct-64-tea-cfb-base [0x7b 0x07 0xe8 0xba 0xf6 0x42 0xeb 0x81]))

(def ^{:doc "TEA/CFB/ISO7816 test ciphertext"}
  ct-64-tea-cfb-iso7816
  (into ct-64-tea-cfb-base [0x7b 0x07 0xe8 0xba 0x76 0x42 0xeb 0x85]))

(def ^{:doc "TEA/CFB/PKCS7 test ciphertext"}
  ct-64-tea-cfb-pkcs7
  (into ct-64-tea-cfb-base [0x7b 0x07 0xe8 0xba 0xf2 0x46 0xef 0x81]))

(def ^{:doc "TEA/CFB/ZERO test ciphertext"}
  ct-64-tea-cfb-zero
  (into ct-64-tea-cfb-base [0x7b 0x07 0xe8 0xba 0xf6 0x42 0xeb 0x85]))

(def ^{:doc "Base TEA/OFB test ciphertext"}
  ct-64-tea-ofb-base
  [0x15 0x82 0x5f 0x2a 0xe5 0xcf 0xc0 0x23
   0xd2 0x15 0x28 0xf4 0x71 0xd0 0x3a 0xb2
   0x7b 0xd5 0x90 0x8a 0xc4 0x5e 0xd7 0xea
   0x6b 0xd2 0x2b 0xa6 0x74 0xf3 0x20 0x0d
   0xbb 0xc0 0x22 0x6f 0xbb 0x08 0x7f 0xe1])

(def ^{:doc "TEA/OFB/X923 test ciphertext"}
  ct-64-tea-ofb-x923
  (into ct-64-tea-ofb-base [0x3b 0x3c 0xb5 0x56 0x23 0x45 0x5c 0xbd]))

(def ^{:doc "TEA/OFB/ISO7816 test ciphertext"}
  ct-64-tea-ofb-iso7816
  (into ct-64-tea-ofb-base [0x3b 0x3c 0xb5 0x56 0xa3 0x45 0x5c 0xb9]))

(def ^{:doc "TEA/OFB/PKCS7 test ciphertext"}
  ct-64-tea-ofb-pkcs7
  (into ct-64-tea-ofb-base [0x3b 0x3c 0xb5 0x56 0x27 0x41 0x58 0xbd]))

(def ^{:doc "TEA/OFB/ZERO test ciphertext"}
  ct-64-tea-ofb-zero
  (into ct-64-tea-ofb-base [0x3b 0x3c 0xb5 0x56 0x23 0x45 0x5c 0xb9]))

(def ^{:doc "Base TEA/CTR test ciphertext"}
  ct-64-tea-ctr-base
  [0x15 0x82 0x5f 0x2a 0xe5 0xcf 0xc0 0x23
   0x2a 0x60 0xf3 0xd5 0xcd 0x08 0xf2 0x12
   0x80 0x5b 0x30 0x05 0x7d 0xaf 0x76 0x67
   0x7c 0x8d 0x96 0xe6 0x25 0xcb 0x0e 0xc7
   0x08 0x34 0x38 0xd2 0x34 0xcb 0x73 0x7e])

(def ^{:doc "TEA/CTR/X923 test ciphertext"}
  ct-64-tea-ctr-x923
  (into ct-64-tea-ctr-base [0x63 0xf9 0x26 0x9e 0x45 0x1e 0x3f 0x76]))

(def ^{:doc "TEA/CTR/ISO7816 test ciphertext"}
  ct-64-tea-ctr-iso7816
  (into ct-64-tea-ctr-base [0x63 0xf9 0x26 0x9e 0xc5 0x1e 0x3f 0x72]))

(def ^{:doc "TEA/CTR/PKCS7 test ciphertext"}
  ct-64-tea-ctr-pkcs7
  (into ct-64-tea-ctr-base [0x63 0xf9 0x26 0x9e 0x41 0x1a 0x3b 0x76]))

(def ^{:doc "TEA/CTR/ZERO test ciphertext"}
  ct-64-tea-ctr-zero
  (into ct-64-tea-ctr-base [0x63 0xf9 0x26 0x9e 0x45 0x1e 0x3f 0x72]))

(def ^{:private true
       :doc     "Test vectors as defined in the spec."}
  test-vectors [[[0x00 0x11 0x22 0x33 0x44 0x55 0x66 0x77
                  0x88 0x99 0xaa 0xbb 0xcc 0xdd 0xee 0xff]
                 [0x01 0x23 0x45 0x67 0x89 0xab 0xcd 0xef]
                 [0x12 0x6c 0x6b 0x92 0xc0 0x65 0x3a 0x3e]]])

(def ^{:private true
       :doc     "Suite tests"}
  test-suites [[:ecb :iso7816 ct-64-tea-ecb-iso7816]
               [:ecb :iso10126 ct-64-tea-ecb-base]
               [:ecb :pkcs7 ct-64-tea-ecb-pkcs7]
               [:ecb :x923 ct-64-tea-ecb-x923]
               [:ecb :zero ct-64-tea-ecb-zero]
               [:cbc :iso7816 ct-64-tea-cbc-iso7816]
               [:cbc :iso10126 ct-64-tea-cbc-base]
               [:cbc :pkcs7 ct-64-tea-cbc-pkcs7]
               [:cbc :x923 ct-64-tea-cbc-x923]
               [:cbc :zero ct-64-tea-cbc-zero]
               [:pcbc :iso7816 ct-64-tea-pcbc-iso7816]
               [:pcbc :iso10126 ct-64-tea-pcbc-base]
               [:pcbc :pkcs7 ct-64-tea-pcbc-pkcs7]
               [:pcbc :x923 ct-64-tea-pcbc-x923]
               [:pcbc :zero ct-64-tea-pcbc-zero]
               [:cfb :iso7816 ct-64-tea-cfb-iso7816]
               [:cfb :iso10126 ct-64-tea-cfb-base]
               [:cfb :pkcs7 ct-64-tea-cfb-pkcs7]
               [:cfb :x923 ct-64-tea-cfb-x923]
               [:cfb :zero ct-64-tea-cfb-zero]
               [:ofb :iso7816 ct-64-tea-ofb-iso7816]
               [:ofb :iso10126 ct-64-tea-ofb-base]
               [:ofb :pkcs7 ct-64-tea-ofb-pkcs7]
               [:ofb :x923 ct-64-tea-ofb-x923]
               [:ofb :zero ct-64-tea-ofb-zero]
               [:ctr :iso7816 ct-64-tea-ctr-iso7816]
               [:ctr :iso10126 ct-64-tea-ctr-base]
               [:ctr :pkcs7 ct-64-tea-ctr-pkcs7]
               [:ctr :x923 ct-64-tea-ctr-x923]
               [:ctr :zero ct-64-tea-ctr-zero]])

(def ^{:private true
       :doc     "Configuration Map"}
  cm {:type :tea :eid :str :doe :str})

(describe
  "TEA"
  (check-blocksize cm 64)
  (check-keysizes cm [128])
  (check-test-vectors cm test-vectors)
  (check-test-suites cm test-suites :iv zeros-64-bits))